import{N as W,r as h,u as V,d as L,c as M,b as r,i as o,f as t,F as E,h as B,n as D,e as v,O as P,t as d,l as C,p as n,q as U,a as G,w as N,C as w,P as J,j as g,M as y,B as b,m as A,o as S,D as K}from"./index-D3FcfwG7.js";import{D as Q}from"./DeleteIcon-Cxmk8bPL.js";import{E as X}from"./EditDealIcon-Bp5hQpbV.js";import{E as Z}from"./EditDealModal-Bq14utiL.js";import{C as tt}from"./ConfirmDeleteModal-B6QFZytj.js";import"./cloneDeep-DIZNXq_f.js";const st=W("activity",()=>{const m=h([]),f=V();return{comments:m,addComment:(_,u)=>{const e=f.deals.find(a=>a.id===u);e&&(e.comments?.push(_),m.value.push(_))},deleteComment:(_,u)=>{const e=f.deals.find(a=>a.id===u);e&&(m.value=m.value.filter(a=>a.id!==_),e.comments=e.comments?.filter(a=>a.id!==_))}}},{persist:!0}),et={key:0,class:"activity"},ot={class:"activity__list"},lt={class:"log__info"},at={class:"log__descr"},it={class:"log__date"},dt={class:"log__text"},nt=["src"],_t={key:1,class:"no-activity"},ct=L({__name:"AllActivityModal",props:{id:{}},setup(m){const f=m,p=V().deals.find(u=>u.id===f.id),_=M(()=>p?.comments?.length);return(u,e)=>o(p)&&_.value!==void 0&&_.value>0?(n(),r("div",et,[t("ul",ot,[(n(!0),r(E,null,B(o(p).comments,a=>(n(),r("li",{class:"activity__item",key:a.id},[t("div",lt,[v(P),t("div",at,[t("p",it,d(o(C)(a.date).format("DD MMM YYYY")),1),t("p",dt,d(a.text),1)])]),a.image?(n(),r("img",{key:0,src:a.image,alt:"comment image",class:"log__img"},null,8,nt)):D("",!0)]))),128))])])):(n(),r("div",_t,e[0]||(e[0]=[t("p",{class:"activity__title"},"No activities found",-1)])))}}),rt=U(ct,[["__scopeId","data-v-a8471aff"]]),ut={key:0,class:"details"},mt={class:"details__left"},pt={class:"details__customer"},vt={class:"details__customer-item"},ft={class:"details__customer-info"},gt={class:"details__customer-item"},yt={class:"details__customer-info"},Dt={class:"details__customer-item"},ht={class:"details__customer-info"},Mt={class:"details__main-info"},Ct={class:"details__address"},$t={class:"details__title"},kt={class:"details__wrapper"},xt={class:"details__other-info"},Yt={class:"details__info"},bt={class:"details__item"},At={class:"details__about"},St={class:"details__item"},Et={class:"details__about"},Vt={class:"details__item"},It={class:"details__about"},Nt={class:"details__item"},wt={class:"details__about"},Lt={class:"details__item"},Bt={class:"details__about"},Pt={class:"details__item"},Ut={class:"details__about"},Rt={class:"detail__item-xl"},Tt={class:"details__about-xl"},Ft=["src"],jt={class:"details__right"},Ht={class:"details__rec-activity"},Ot={class:"rec__descr"},qt={class:"rec__img-container"},zt={key:0,class:"details__log"},Wt={class:"log__content"},Gt={class:"log__info"},Jt={class:"log__descr"},Kt={class:"log__date"},Qt={class:"log__text"},Xt=["src"],Zt={key:1,class:"details__log"},ts=L({__name:"DealView",props:{id:{}},setup(m){const f=m,$=K(),p=V(),_=G(),u=st(),e=p.deals.find(l=>l.id===Number(f.id)),a=M(()=>`${e.customer.name} ${e.customer.secondname}`),R=M(()=>`${e.address.street}, ${e.address.city}, ${e.address.state} ${e.address.zipCode}`),T=M(()=>u.comments.slice(0,3)),I=M(()=>e?.comments?.length),c=h(null),k=h(""),x=h(""),Y=h(C().format("YYYY-MM-DD")),F=l=>{_.openModal(y.EditModal),c.value=l},j=l=>{_.openModal(y.DeleteDeal),c.value=l},H=l=>{_.openModal(y.Activity),c.value=l},O=l=>{p.updateDeal(l),c.value=null,_.closeModal()},q=l=>{try{p.deleteDeal(l,e.customer.cid),c.value=null,_.closeModal(),$.push("/deals")}catch(s){console.error("Error deleting deal:",s)}},z=()=>{const l={id:Date.now(),date:new Date(Y.value),text:k.value,image:x.value};try{e&&l.text&&l.date&&(e.comments?.push(l),u.comments.push(l))}catch(s){console.error("Error adding activity:",s)}};return(l,s)=>(n(),r(E,null,[o(e)?(n(),r("div",ut,[t("div",mt,[t("ul",pt,[t("li",vt,[s[7]||(s[7]=t("p",{class:"details__name"},"Customer",-1)),t("p",ft,d(a.value),1)]),t("li",gt,[s[8]||(s[8]=t("p",{class:"details__name"},"Email",-1)),t("p",yt,d(o(e).customer.email),1)]),t("li",Dt,[s[9]||(s[9]=t("p",{class:"details__name"},"Phone",-1)),t("p",ht,d(o(e).customer.phone),1)])]),t("div",Mt,[t("div",Ct,[t("h5",$t,d(R.value),1),t("div",kt,[t("button",{class:"details__delete",onClick:s[0]||(s[0]=i=>j(o(e)))},[v(Q)]),t("button",{class:"details__edit",onClick:s[1]||(s[1]=i=>F(o(e)))},[v(X)])])])]),t("div",xt,[t("ul",Yt,[t("li",bt,[s[10]||(s[10]=t("p",{class:"details__name"},"Progress",-1)),t("h5",At,d(o(e).progress),1)]),t("li",St,[s[11]||(s[11]=t("p",{class:"details__name"},"Appointment Date",-1)),t("h5",Et,d(o(C)(o(e).date).format("MMM DD, YYYY HH:mm")),1)]),t("li",Vt,[s[12]||(s[12]=t("p",{class:"details__name"},"Room Area",-1)),t("h5",It,d(o(e).area),1)]),t("li",Nt,[s[13]||(s[13]=t("p",{class:"details__name"},"Number of People",-1)),t("h5",wt,d(o(e).numOfPeople),1)]),t("li",Lt,[s[14]||(s[14]=t("p",{class:"details__name"},"Price",-1)),t("h5",Bt,d(o(e).price)+"$",1)]),t("li",Pt,[s[15]||(s[15]=t("p",{class:"details__name"},"Room Access",-1)),t("h5",Ut,d(o(e).accessCode),1)]),t("li",Rt,[s[16]||(s[16]=t("p",{class:"details__name"},"Special Instructions",-1)),t("h5",Tt,d(o(e).instructions),1)])]),t("img",{src:o(e).image,alt:"deal img",class:"details__img"},null,8,Ft)])]),t("div",jt,[t("div",Ht,[s[19]||(s[19]=t("h5",{class:"rec__title"},"Record Activity",-1)),t("div",Ot,[s[18]||(s[18]=t("p",{class:"rec__title"},"Description",-1)),N(t("input",{type:"text",class:"rec__input",placeholder:"Write your notes","onUpdate:modelValue":s[2]||(s[2]=i=>k.value=i)},null,512),[[w,k.value]]),N(t("input",{type:"date",class:"rec__input","onUpdate:modelValue":s[3]||(s[3]=i=>Y.value=i)},null,512),[[w,Y.value]]),t("div",qt,[s[17]||(s[17]=t("p",{class:"rec__title"},"Images",-1)),v(J,{modelValue:x.value,"onUpdate:modelValue":s[4]||(s[4]=i=>x.value=i)},null,8,["modelValue"])])]),t("button",{class:"rec__btn",onClick:z},"Save")]),I.value&&I.value>0?(n(),r("div",zt,[s[20]||(s[20]=t("h5",{class:"rec__title"},"Activity Log",-1)),t("ul",Wt,[(n(!0),r(E,null,B(T.value,i=>(n(),r("li",{class:"log__item",key:i.id},[t("div",Gt,[v(P),t("div",Jt,[t("p",Kt,d(o(C)(i.date).format("DD MMM YYYY")),1),t("p",Qt,d(i.text),1)])]),i.image?(n(),r("img",{key:0,src:i.image,alt:"comment image",class:"log__img"},null,8,Xt)):D("",!0)]))),128))]),t("button",{class:"log__btn",onClick:s[5]||(s[5]=i=>H(o(e)))},"Load More")])):(n(),r("div",Zt,s[21]||(s[21]=[t("h5",{class:"rec__title"},"Activity Log",-1),t("div",{class:"no-log__descr"},[t("p",{class:"no-log__text"},"No activities found for this deal"),t("p",{class:"no-log__text"},"You can add activity in form on top")],-1)])))])])):D("",!0),v(b,{type:o(y).EditModal},{title:g(()=>s[22]||(s[22]=[S("Edit Deal")])),default:g(()=>[c.value?(n(),A(Z,{key:0,deal:c.value,"onUpdate:deal":O,onClose:s[6]||(s[6]=i=>c.value=null)},null,8,["deal"])):D("",!0)]),_:1},8,["type"]),v(b,{type:o(y).DeleteDeal},{title:g(()=>s[23]||(s[23]=[S("Deleting Deal")])),default:g(()=>[c.value?(n(),A(tt,{key:0,id:c.value.id,onConfirm:q},null,8,["id"])):D("",!0)]),_:1},8,["type"]),v(b,{type:o(y).Activity},{title:g(()=>s[24]||(s[24]=[S("All activities")])),default:g(()=>[c.value?(n(),A(rt,{key:0,id:c.value.id},null,8,["id"])):D("",!0)]),_:1},8,["type"])],64))}}),ds=U(ts,[["__scopeId","data-v-105d3806"]]);export{ds as default};
